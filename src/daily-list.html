<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="daily-plan.html">

<link rel="lazy-import" href="plan-manager.html">

<dom-module id="daily-list">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }

      .avatar {
          display: inline-block;
          box-sizing: border-box;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background: var(--paper-blue-500);
      }

      #dialog {
        width: 350px;
      }
    </style>

    <div class="card">
      <iron-list items="{{dailyList}}" as="item" id="daily-list" on-selected-item-changed="showPlan" selection-enabled=true>
        <template>
          <paper-icon-item>
            <div class="avatar blue" slot="item-icon"></div>
            <paper-item-body two-line>
                <div>[[item.date]]</div>
                <div secondary>[[item.limits]]</div>
            </paper-item-body>
            <paper-icon-button icon="icons:create" alt="Edit item" on-tap="_editDailyPlan"></paper-icon-button>
          </paper-icon-item>
        </template>
      </iron-list>
    </div>

    <paper-dialog id="dialog">
      <h2>Daily plan</h2>
      <daily-plan daily-plan=[[selectedItem]] limits=[[limits]]></daily-plan>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
      </div>
    </paper-dialog>
  </template>

  <script>
    class DailyList extends Polymer.Element {
      static get is() { return 'daily-list'; }

      static get properties() {
        return {
          dailyList: {
            type: Array,
            value: [],
            observer: '_sortList'
          },
          limits: Array,
          selectedItem: Object,
          user: String
        };
      }

      showPlan(event) {
        let item = event.detail.value;
        if (item !== null) {
          this.selectedItem = item;
          this.$.dialog.open();
        }
      }

      _editDailyPlan(e) {
        const item = e.model.item;
        this.dispatchEvent(new CustomEvent('dzinia-edit-daily-plan', {detail: item, bubbles: true, composed: true}));
      }

      _sortList() {
        // this.dailyList.sort((d1, d2) => new Date(d2.date).getTime() - new Date(d1.date).getTime());
        // let myarray = this.dailyList;
        // console.log(myarray);
        // myarray.sort((d1, d2) => new Date(d2.date).getTime() - new Date(d1.date).getTime());
         console.log('Daily PLAN...');
        // console.log(typeof myarray);
        // console.log(myarray.isArray);
        // for (let index = 0; index < myarray.length; index++) {
        //   const element = myarray[index];
        //   console.log(element);
          
        // }
        // console.log(myarray[0]);
        // let a1 = myarray[0].date;
        // let a2 = myarray[1].date;
        // console.log(new Date(a1).getTime());
        // console.log(new Date(a2).getTime());
        // console.log(new Date(a1));
        // console.log(new Date(a2));
      }
    }

    window.customElements.define(DailyList.is, DailyList);
  </script>
</dom-module>
